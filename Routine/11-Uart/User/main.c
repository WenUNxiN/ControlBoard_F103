/***************************************************************
 * 文件名称：ArmControl.c
 * 作    者：IMSY
 * 日    期：2025-05-20
 * 所属单位：小艾机器人科技有限公司
 * 工程名称：ArmControl
 *
 * 硬件配置：
 *   单片机：STM32F103C8T6
 *   主频  ：72 MHz
 *
 * 功能描述：
 *   1. 初始化系统时钟、SysTick、GPIO 重映射（仅保留 SWD）。
 *   2. 初始化 USART1（115200 bps，8N1）。
 *   3. 通过 USART1 发送固定字符串与字符，验证串口收发。
 *   4. 注册串口接收回调，收到数据后原样回显。
 ***************************************************************/

#include "main.h"
#include "SysTick.h"
#include "rcc.h"
#include "sys.h"
#include "Uart.h"

/*--------------------------------------------------------------
 * USART1 接收完成回调函数
 * 形参：
 *   data : 指向接收缓冲区的指针
 *   len  : 本次接收到的字节数
 * 说明：
 *   接收完成后由底层驱动自动调用，本例直接将数据回显。
 *-------------------------------------------------------------*/
void Usart1_on_recv(uint8_t* data, uint32_t len)
{
    /* 通过 printf 回显收到的字符串 */
    printf("recv: %s\r\n", data);
}

/*--------------------------------------------------------------
 * 主函数
 *-------------------------------------------------------------*/
int main(void)
{
    /* 1. 系统时钟初始化，使能 72 MHz HSE/PLL */
    Rcc_Init();

    /* 2. GPIO 重映射：关闭 JTAG，仅保留 SWD，释放 PA15/PB3/PB4 */
    SWJGpio_Init();

    /* 3. SysTick 初始化 */
    SysTickInit();

    /* 4. USART1 初始化：波特率 115200，8 数据位，无校验，1 停止位 */
    Uart1_Init(115200);

    /* 5. 发送单个字符 'A'，验证基本发送功能 */
    Uart1_send_data('A');

    /* 6. 发送字符串及换行，验证字符串发送 */
    Uart1_send_String("\nholle\r\n");

    /* 7. 通过 printf 发送字符串（需实现 fputc 重定向） */
    printf("holle\r\n");

    
    while (1)
    {
        
    }
}
